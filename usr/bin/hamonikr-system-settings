#!/bin/bash
# Default System Settings for HamoniKR OS

touch /var/log/${0##*/}.log
echo "$(date +%Y-%m-%d_%H:%M) : ${0##*/} $1 running." | tee /var/log/${0##*/}.log >/dev/null 2>&1


if [ -f "/etc/initramfs-tools/initramfs.conf" ] ; then
    # Change to COMPRESS=gzip
    sed -i 's/COMPRESS=lz4/COMPRESS=gzip/g' /etc/initramfs-tools/initramfs.conf
fi

if [ -f "/etc/sysctl.conf" ] ; then
    # Change kernel log level
    sed -i 's/#kernel.printk = 3 4 1 3/kernel.printk = 3 3 3 3/g' /etc/sysctl.conf 
fi

if [ -f "/usr/share/applications/naver-whale.desktop" ] ; then
    # Change password store to basic
    sed -i 's|Exec=/usr/bin/naver-whale-stable %U|Exec=/usr/bin/naver-whale-stable %U --password-store=basic|g' /usr/share/applications/naver-whale.desktop
fi

if [ -f "/usr/local/bin/hamonikr-theme-start" ] ; then
    # Update applet.js, if installed hamonikr-theme
    # show help message when mouse over on menu item
    echo "$(date +%Y-%m-%d_%H:%M) : Update applet.js" | tee /var/log/${0##*/}.log 
    sed -i 's|this.selectedAppBox.set_height(0);|//this.selectedAppBox.set_height(0);|g' /usr/share/cinnamon/applets/menu@cinnamon.org/applet.js
    
fi

# add running user count
if [ -f "/usr/bin/curl" ] ; then
    RD=`head -c 16 /dev/urandom | md5sum | head -c 32`
    CODE="jin-live"
    VER="4.0"
    curl -XPOST "http://pms.invesume.com:8086/write?db=hamonikr" --data-binary "machineid,codename=$CODE,version=$VER value=\"$RD\""
fi    
